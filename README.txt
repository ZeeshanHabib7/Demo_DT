What's Good:

The code is split into separate sections, which is helpful for managing and reusing code.
Some comments are added to explain what the code is doing.

What Could Be Improved:

Some parts of the code do the same thing multiple times, which makes the code longer and harder to manage.
There are special words and numbers in the code that are hard to understand. Using simpler words or explaining them would help.
In some places, the conditions (the if-checks) are too complicated. Making them simpler would make the code easier to read.
The code talks to the database inside loops, which can make it slower. It's better to talk to the database fewer times.

Suggestions for Making It Better:

Use the same kind of words for variables and functions, so it's easier to understand.
Make each part of the code do just one thing. This makes the code easier to change and read.
Use short breaks to stop the code when a condition is met, so the code isn't too complicated.
Try to talk to the database fewer times, especially inside loops.
Instead of making things directly inside the code, it's better to use ready-made parts (like email-sending) that can be used in many places.

Overall:
The code is trying to do a good job, but it could be simpler and easier to read. By using clearer words, organizing the code better, and fixing some tricky parts, it would be easier to work with and understand.